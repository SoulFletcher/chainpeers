<!DOCTYPE html>
<html>
<head>
    <title>Data</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .scrollable-div {
            width: 100%;
            height: 200px;
            overflow: auto;
            margin-bottom: 20px;
            border: 1px solid #000;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="scrollable-div">
        <h1>Peer Data</h1>
        {% for peer in data.peer_data %}
            <p>{{ peer.id }} - {{ peer.address }} - {{ peer.version }} - {{ peer.is_starting }}</p>
        {% endfor %}
    </div>

    <div class="scrollable-div">
        <h1>Slice Data</h1>
        {% for slice in data.slice_data %}
            <p>{{ slice.id }} - {{ slice.is_open }} - {{ slice.chain_name }} - {{ slice.time }} - {{ slice.starting_peers }}</p>
        {% endfor %}
    </div>

    <div class="scrollable-div">
        <h1>Slice Results Data</h1>
        {% for result in data.slice_results_data %}
            <p>{{ result.id }} - {{ result.slice_id }} - {{ result.peer_ids }}</p>
        {% endfor %}
    </div>
<input type="text" id="version" placeholder="Enter version">
    <button onclick="loadData()">Load Data</button>
    <div id="addresses"></div>
    <canvas id="chart"></canvas>

    <script>
        var chart;  // declare the chart variable outside the function

function loadData() {
    var version = document.getElementById('version').value;
    axios.get('http://0.0.0.0:8000/peers/' + version)
        .then(function (response) {
            var peers = response.data.peers;
            var labels = peers.map(function(peer) { return peer.time; });
            console.log(labels)
            var data = peers.map(function(peer) { return Number(peer.score); });

            // destroy the old chart if it exists
            if (chart) {
                chart.destroy();
            }

            // count the number of peers with the same data and score
            var counts = {};
            for (var i = 0; i < peers.length; i++) {
                var key = peers[i].time + '-' + Number(peers[i].score);
                counts[key] = (counts[key] || 0) + 1;

            }

            var ctx = document.getElementById('chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Score',
                        data: data,
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,

                    }]
                },
            });

            // update the addresses div
            var addresses = peers.map(function(peer) { return peer.address; }).join('<br>');
            document.getElementById('addresses').innerHTML = addresses;
        })
        .catch(function (error) {
            console.log(error);
        });
}



    </script>
</body>
</html>
